---
title: "The Project"
author: "Ian Curtis, Stacy Keydel, Sarba Uprety"
output: html_document
date: 2021-11-02
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_packages, message=FALSE}
library(tidyverse)
library(lubridate)
```

```{r read_data, message=FALSE}
my_files <- list.files(path=here::here("data/"), pattern="*.csv", full.names = TRUE)
big_spotify <- read_csv(my_files)
```

```{r}
big_spotify <- big_spotify %>% 
  mutate(year = substr(release_date, 1, 4),
         duration_s = as.duration(duration) / 1000)
spotify_nodup <- big_spotify %>% 
  distinct(track_uri, .keep_all = TRUE)
spotify_nodup <- spotify_nodup[-20]
```


```{r eda_numeric}
funs <- c(mean = mean, median = median, max = max, min = min)
spotify %>% 
  select(where(is.numeric)) %>% 
  map_df(~ funs %>%
           map(exec, .x), .id = "var")
# Go back to look at loudness, tempo, duration_ms, time_signature, year
```

```{r eda_loudness}
big_spotify %>% 
  filter(loudness < -50) %>% 
  select(track_name, artist_name, loudness) %>% 
  arrange(desc(loudness))
# Some songs are silent
# Some songs are so ridiculously loud (like TV static)
```

```{r eda_tempo}
spotify %>% 
  filter(tempo > 200) %>% 
  select(name, artists, tempo) %>% 
  arrange(desc(tempo))
#spotify %>%  ggplot(aes(x = tempo)) +
  #geom_bar()
# 0 tempo: some are short or have a mess of sound. Some do have a tempo and this may be an error.
# Large tempo: song was recorded in half time and Spotify records it in 4/4
```

```{r eda_duration}
spotify %>% 
  filter(duration_s < 2) %>% 
  select(name, artists, duration_s) %>% 
  arrange(desc(duration_s))
# Human by Anggun is not this slow
```

```{r eda_timesig}
spotify %>% 
  filter(time_signature < 1) %>% 
  select(name, artists, time_signature) %>% 
  arrange(desc(time_signature))
```

```{r}
spotify %>% 
  filter(year < 1500) %>% 
  select(name, artists, year) %>% 
  arrange(desc(year))
# There are ten songs without years. They actually have years so we have to manually add them.
# We also corrected the duration of the incorrect song.

# spotify <- spotify %>% 
#   mutate(
#     year = case_when(
#       (name %in% c("Jimmy Neutron", "My Heart")) & (artists == "iCizzle") ~ 2017,
#       (name %in% c("I Luv You", "I Am (Invincible)", "Flower Power", "Heard It Low", "Hangin On", "God Loves You", "You In My Life", "I Wonder")) & (artists == "iCizzle") ~ 2018,
#       TRUE ~ year
#     ),
#     duration_s = case_when(
#       (name %in% c("Human")) & (artists == "Anggun") ~ duration(198),
#       TRUE ~ duration_s
#     )
#   )
```

```{r}
library(funModeling) 
library(Hmisc)

status(big_spotify)

#EDA of the data as a whole
ggplot (data = big_spotify) +
  geom_histogram(mapping = aes(x = duration_s), binwidth = 10)


```


```{r}

##histogram and count for reference
ggplot (data = big_spotify) +
  geom_histogram (mapping = aes(x = loudness), binwidth = 0.1)

spotify %>%
  count(loudness)

ggplot(data = big_spotify, mapping = aes(x = loudness, colour = explicit)) +
  geom_freqpoly(binwidth = 0.1)

#boxplots of big_spotify to look for trends
ggplot(data = big_spotify, mapping = aes(x = energy)) +
  geom_boxplot()
ggplot(data = big_spotify, mapping = aes(x = popularity)) +
  geom_boxplot()
ggplot(data = big_spotify, mapping = aes(x = danceability)) +
  geom_boxplot()
ggplot(data = big_spotify, mapping = aes(x = key)) +
  geom_boxplot()
ggplot(data = big_spotify, mapping = aes(x = loudness)) +
  geom_boxplot()
ggplot(data = big_spotify, mapping = aes(x = speechiness)) +
  geom_boxplot()
ggplot(data = big_spotify, mapping = aes(x = acousticness)) +
  geom_boxplot()
ggplot(data = big_spotify, mapping = aes(x = liveness)) +
  geom_boxplot()
ggplot(data = big_spotify, mapping = aes(x = valence)) +
  geom_boxplot()
ggplot(data = big_spotify, mapping = aes(x = tempo)) +
  geom_boxplot()


```

```{r}
funs <- c(mean = mean, median = median, max = max, min = min)
big_spotify %>% 
  select(where(is.numeric)) %>% 
  map_df(~ funs %>%
           map(exec, .x), .id = "var")
```

```{r}
big_spotify %>% 
  summarise(min1 = min(release_date), max1 = max(release_date, min2 = min(year), max2 = max(year)))
```



